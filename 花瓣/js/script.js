"use strict";var DOMAIN="huaban.com";var global="HUABAN_GLOBAL";var old_global="__huaban";var global_settings="HUABAN_PRESETTINGS";var insertScript=function(b){var a=document.getElementById("HUABAN_WIDGET_SCRIPT");if(a){a.parentNode.removeChild(a)}a=document.createElement("script");a.setAttribute("charset","utf-8");a.setAttribute("id","HUABAN_WIDGET_SCRIPT");a.innerText=b.replace(/\s{2,}/g," ");document.body.appendChild(a)};var insertBookmarklet=function(c){var b="    (function(w,g,m,i,d){      w[g]=w[g]||{};      w[g].autoInitialize=false;      w[g].autoAttachFloatingButton=i;      w[g].imageMinWidth=w[g].imageMinHeight=w[g].elemMinWidth=w[g].elemMinHeight=m;      w['__huaban_dev']=d;    }(window,'"+global_settings+"',"+c.minWidth+","+c.isToggleOn+",'"+DOMAIN+"'));";var d="(function(){var e=document.createElement('script');e.setAttribute('type','text/javascript');e.setAttribute('charset','UTF-8');e.setAttribute('src','https://huaban.com/js/widgets.min.js?'+Math.floor(new Date()/1e7));document.body.appendChild(e)}());";var a=b+d;insertScript(a)};chrome.runtime.sendMessage({msg:"settings"},function(a){insertBookmarklet(a)});var takeAction=function(b){var a="    (function(w,d,g,a) {      w[g] && w[g]['interface'] && w[g]['interface'][a]();      var el = d.getElementById('HUABAN_WIDGET_SCRIPT');      el.parentNode.removeChild(el);    })(window,document,'"+global+"','"+b+"');";insertScript(a)};var attachFloatingButton=function(){takeAction("attachFloatingButton")};var detachFloatingButton=function(){takeAction("detachFloatingButton")};var showValidImages=function(){takeAction("show")};var pinImage=function(b){var a="    (function(w,d,g,a,t) {      w[g] && w[g]['interface'] && w[g]['interface'][a](t);      var el = d.getElementById('HUABAN_WIDGET_SCRIPT');      el.parentNode.removeChild(el);    })(window,document,'"+global+"','pinImageUrl','"+b+"');";insertScript(a);(function(){var f=document.getElementById("HUABAN_MESSAGE");try{var d=f.innerText;d=JSON.parse(d);window.open(d.url,"",d.features)}catch(c){console.error(c)}})()};var target=null;document.body.addEventListener("contextmenu",function(a){target=a.target});chrome.runtime.onMessage.addListener(function(c,b,a){if(c.msg){switch(c.msg){case"showValidImages":showValidImages();break;case"pinImage":if(target.width>=16&&target.height>=16){pinImage(target.src)}else{showValidImages()}break;case"toggle":if(c.isToggleOn){attachFloatingButton()}else{detachFloatingButton()}break;default:break}}});