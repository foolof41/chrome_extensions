"use strict";function init(){var c=$("pin-all-btn");var b=$("capture-area-item");var e=$("capture-viewport-item");var g=$("capture-fullpage-item");$("extName").innerHTML=chrome.i18n.getMessage("extName");$("preferences").title=chrome.i18n.getMessage("preferences");$("visit").innerHTML=chrome.i18n.getMessage("visit")+":";$("huaban-link").innerHTML=chrome.i18n.getMessage("siteName");b.getElementsByTagName("span")[0].innerHTML=chrome.i18n.getMessage("captureArea");e.getElementsByTagName("span")[0].innerHTML=chrome.i18n.getMessage("captureViewport");g.getElementsByTagName("span")[0].innerHTML=chrome.i18n.getMessage("captureFullpage");c.getElementsByTagName("span")[0].innerHTML=chrome.i18n.getMessage("pinAllText");(function a(){var h=document.getElementsByTagName("a");for(var j=0;h[j];j++){h[j].addEventListener("click",function(){if(this.href&&!~this.href.indexOf("chrome-extension")){window.open(this.href)}return false})}})();(function f(){var j=$$("#menu .capture");for(var h=0;h<j.length;h++){if(!j[h].classList.contains("disabled")){j[h].classList.add("disabled")}}})();(function d(){var h=$("toggle-btn");h.addEventListener("click",function(){chrome.runtime.sendMessage({msg:"toggle"},function(i){var j=i.isToggleOn;var k=h.getElementsByTagName("span")[0];k.setAttribute("class",j?"checked":"unchecked")});chrome.runtime.sendMessage({msg:"ga",type:"popup item",value:"toggleBtn"},function(){})});chrome.runtime.sendMessage({msg:"isToggleOn"},function(i){var j=i.isToggleOn;var k=h.getElementsByTagName("span")[0];k.innerHTML=chrome.i18n.getMessage("toggleBtnText");k.setAttribute("class",j?"checked":"unchecked")})})();c.addEventListener("click",function(){if(this.classList.contains("disabled")){return false}chrome.tabs.query({active:true,currentWindow:true},function(h){var i=h[0];var j=i.url.replace(/^https?:\/\/(www)?/,"");if(j.indexOf(DOMAIN)==0){return}chrome.tabs.sendMessage(i.id,{msg:"showValidImages"},function(k){})});chrome.runtime.sendMessage({msg:"ga",type:"popup item",value:"pinAll"},function(){});setTimeout(function(){window.close()},100)});g.addEventListener("click",function(){if(this.classList.contains("disabled")){return false}chrome.runtime.sendMessage({msg:"ga",type:"popup item",value:"captureWebpage"},function(){});var h=chrome.extension.getBackgroundPage();h.screenshot.captureFullpage();window.close()});e.addEventListener("click",function(){if(this.classList.contains("disabled")){return false}chrome.runtime.sendMessage({msg:"ga",type:"popup item",value:"captureWindow"},function(){});var h=chrome.extension.getBackgroundPage();h.screenshot.captureViewport();window.close()});b.addEventListener("click",function(){if(this.classList.contains("disabled")){return false}chrome.runtime.sendMessage({msg:"ga",type:"popup item",value:"captureArea"},function(){});var h=chrome.extension.getBackgroundPage();h.screenshot.showSelectionArea();window.close()});chrome.tabs.query({active:true,currentWindow:true},function(k){var j=k[0].id;var h=parseInt(window.navigator.appVersion.match(/Chrome\/(\d+)\./)[1],10);if(h>26){var i=chrome.tabs.connect(j);i.onMessage.addListener(function(l){if(l.msg=="capturable"){$("capture-area-item").classList.remove("disabled");$("capture-viewport-item").classList.remove("disabled");$("capture-fullpage-item").classList.remove("disabled")}else{if(l.msg=="uncapturable"){$("capture-area-item").classList.add("disabled");$("capture-viewport-item").classList.add("disabled");$("capture-fullpage-item").classList.add("disabled")}}if(l.msg=="pinable"){$("pin-all-btn").classList.remove("disabled")}else{if(l.msg=="unpinable"){$("pin-all-btn").classList.add("disabled")}}});i.postMessage({msg:"is_page_capturable"});i.postMessage({msg:"is_page_pinable"})}else{chrome.tabs.sendMessage(j,{msg:"is_page_capturable"},function(l){if(l.msg=="capturable"){$("capture-area-item").classList.remove("disabled");$("capture-viewport-item").classList.remove("disabled");$("capture-fullpage-item").classList.remove("disabled")}else{if(l.msg=="uncapturable"){$("capture-area-item").classList.add("disabled");$("capture-viewport-item").classList.add("disabled");$("capture-fullpage-item").classList.add("disabled")}}});chrome.tabs.sendMessage(j,{msg:"is_page_pinable"},function(l){if(l.msg=="pinable"){$("pin-all-btn").classList.remove("disabled")}else{if(l.msg=="unpinable"){$("pin-all-btn").classList.add("disabled")}}})}})}document.addEventListener("DOMContentLoaded",init);chrome.runtime.onMessage.addListener(function(c,b,a){if(c.msg=="page_capturable"){$("capture-area-item").classList.remove("disabled");$("capture-viewport-item").classList.remove("disabled");$("capture-fullpage-item").classList.remove("disabled")}else{if(c.msg=="page_uncapturable"){$("capture-area-item").classList.add("disabled");$("capture-viewport-item").classList.add("disabled");$("capture-fullpage-item").classList.add("disabled")}}});